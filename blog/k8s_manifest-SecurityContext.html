<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>K8S manifest - SecurityContext</title><meta name="robots" content="follow, index"/><meta name="description" content=""/><meta property="og:url" content="https://demian9k.github.io/blog/k8s_manifest-SecurityContext"/><meta property="og:type" content="article"/><meta property="og:site_name" content="demian11k studylog"/><meta property="og:description" content=""/><meta property="og:title" content="K8S manifest - SecurityContext"/><meta property="og:image" content="https://demian9k.github.io/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="K8S manifest - SecurityContext"/><meta name="twitter:description" content=""/><meta name="twitter:image" content="https://demian9k.github.io/static/images/twitter-card.png"/><link rel="canonical" href="https://demian9k.github.io/blog/k8s_manifest-SecurityContext"/><meta property="article:published_time" content="2023-06-02T02:03:00.000Z"/><meta property="article:modified_time" content="2023-06-02T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://demian9k.github.io/blog/k8s_manifest-SecurityContext"
  },
  "headline": "K8S manifest - SecurityContext",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://demian9k.github.io/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2023-06-02T02:03:00.000Z",
  "dateModified": "2023-06-02T00:00:00.000Z",
  "author": {
    "@type": "Person",
    "name": "demian11k"
  },
  "publisher": {
    "@type": "Organization",
    "name": "demian11k",
    "logo": {
      "@type": "ImageObject",
      "url": "https://demian9k.github.io/static/images/logo.png"
    }
  },
  "description": ""
}</script><meta name="next-head-count" content="21"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/9da9539fac7f1ee9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9da9539fac7f1ee9.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-1667cddafac2eea3.js" defer=""></script><script src="/_next/static/chunks/main-bfc1a3b6dd286443.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e097d8b875e64e46.js" defer=""></script><script src="/_next/static/chunks/140-77b8ab5a870d524b.js" defer=""></script><script src="/_next/static/chunks/574-40cb695d6b511631.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-48fd063b43fdbe6a.js" defer=""></script><script src="/_next/static/_epZdIX6LUAs-N565XCV9/_buildManifest.js" defer=""></script><script src="/_next/static/_epZdIX6LUAs-N565XCV9/_ssgManifest.js" defer=""></script><script src="/_next/static/_epZdIX6LUAs-N565XCV9/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="demian11k.studylog" href="/"><div class="flex items-center justify-between"><div class="mr-3"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2740%27%20height=%2740%27/%3e"/></span><img alt="A" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="rounded-full object-cover object-center md:h-36 lg:h-48" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="A" srcSet="/_next/static/media/demian_avatar_logo.c12b9855.png?imwidth=48 1x, /_next/static/media/demian_avatar_logo.c12b9855.png?imwidth=96 2x" src="/_next/static/media/demian_avatar_logo.c12b9855.png?imwidth=96" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="rounded-full object-cover object-center md:h-36 lg:h-48" loading="lazy"/></noscript></span></div><div class="hidden h-6 text-2xl font-semibold sm:block">demian11k.studylog</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div><header><div class="space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700"><dl><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-06-02T02:03:00.000Z">June 2, 2023</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">K8S manifest - SecurityContext</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0 " style="grid-template-rows:auto 1fr"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h2 id="what-is-privileged-securitycontext-when-we-need-this-what-is-limited-capability-of-pod-or-container-compared-to-host"><a href="#what-is-privileged-securitycontext-when-we-need-this-what-is-limited-capability-of-pod-or-container-compared-to-host" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>what is privileged SecurityContext?, when we need this? what is limited capability of pod or container compared to host</h2><p>A privileged SecurityContext in Kubernetes allows a container to run with extended privileges, essentially bypassing many security restrictions and gaining elevated access within the cluster. When a container is running in privileged mode, it has almost the same privileges and capabilities as the host machine.</p><p>You might need to use privileged SecurityContext in certain scenarios, such as:</p><p>Legacy Applications: Some older applications may require elevated privileges to function properly. They might need direct access to specific system resources or perform operations that are restricted in a non-privileged container. Running such applications in privileged mode can help ensure their proper execution.</p><p>Debugging and Troubleshooting: In certain troubleshooting scenarios, you may need access to low-level system resources or the ability to manipulate network settings. Privileged containers allow you to perform these operations, aiding in debugging and diagnosing issues within the cluster.</p><p>Device Access: Certain devices or hardware components require privileged access to be utilized by containers. Privileged mode allows containers to directly access and control these devices, enabling scenarios like GPU acceleration or direct hardware interaction.</p><p>Despite its potential benefits, using privileged SecurityContext should be approached with caution due to the increased security risks. Running containers in privileged mode essentially removes the isolation and sandboxing provided by Kubernetes, potentially compromising the security and stability of the cluster. Therefore, it is recommended to use privileged mode only when absolutely necessary and ensure that proper security measures are in place.</p><p>When a pod or container is running with limited capabilities compared to the host, it means that the container&#x27;s privileges and access are restricted. By default, containers in Kubernetes are non-privileged and operate within a secure sandboxed environment, with limited access to the host system. They have restricted access to system resources, such as file systems, network configurations, and device drivers. This helps to enforce the principle of least privilege and prevent containers from performing unauthorized or malicious actions.</p><p>Containers running with limited capabilities have the following restrictions compared to the host:</p><p>File System: Containers typically have their own isolated file system, separate from the host&#x27;s file system. They cannot access files outside their designated scope, providing a level of isolation and preventing unauthorized access to host system files.</p><p>Network Configuration: Containers have their own network stack and network namespace, isolated from the host&#x27;s network configuration. They cannot directly modify host network settings or interact with network interfaces outside their own network namespace.</p><p>Device Access: Containers usually have limited access to physical devices or device drivers on the host. They cannot directly access or control hardware devices unless explicitly allowed or passed through using specialized mechanisms like device plugins or passthrough configurations.</p><p>Kernel Capabilities: Containers operate with a restricted set of Linux kernel capabilities, which determine their privileged actions. By default, containers do not have access to sensitive kernel capabilities, preventing them from performing privileged operations that could compromise the host or other containers.</p><p>These limitations ensure that containers run in a secure and isolated manner, reducing the risk of unauthorized actions, privilege escalation, or malicious activities within the Kubernetes cluster.</p><h2 id="why-container-should-have-restrictions-compared-to-host"><a href="#why-container-should-have-restrictions-compared-to-host" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>why container should have restrictions compared to host?</h2><p>Containers should have restrictions compared to the host for several important reasons:</p><p>Isolation and Security: Containers provide an additional layer of isolation and security within a host system. By restricting the capabilities of containers, you limit their access to sensitive resources and reduce the risk of unauthorized actions. This isolation prevents containers from interfering with each other or with the host system, reducing the attack surface and mitigating the potential impact of security breaches.</p><p>Resource Utilization: Containers share the underlying host system&#x27;s resources, such as CPU, memory, and storage. By imposing restrictions on containers, you ensure fair resource allocation and prevent a single container from monopolizing resources or impacting the overall system performance. This allows for efficient utilization of resources across multiple containers running on the same host.</p><p>Principle of Least Privilege: The principle of least privilege is a security best practice that advocates granting the minimum privileges necessary for a system or application to function. By applying restrictions to containers, you enforce this principle and limit their capabilities to only what is required for their intended purpose. This reduces the potential attack surface and minimizes the impact of potential security vulnerabilities.</p><p>Compatibility and Portability: Containers are designed to be portable and compatible across different environments and host systems. By enforcing restrictions on containers, you ensure that they can run in various environments without relying on specific host configurations or dependencies. This enhances the portability and interoperability of containers, allowing them to be deployed consistently across different Kubernetes clusters or container orchestration platforms.</p><p>Stability and Predictability: By restricting container capabilities, you promote stability and predictability within the host system. Containers with limited access to host resources are less likely to cause system instability or conflicts. This ensures that the host system remains reliable and unaffected by the actions of containers, providing a stable environment for other applications and services.</p><p>Overall, restrictions on containers compared to the host promote security, resource efficiency, compatibility, stability, and adherence to the principle of least privilege. By maintaining these restrictions, you establish a secure and controlled environment for running containers, reducing risks and ensuring the overall stability and integrity of your Kubernetes cluster.</p><h1 id="securitycontext"><a href="#securitycontext" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>SecurityContext</h1><h2 id="container-level-securitycontext"><a href="#container-level-securitycontext" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Container level SecurityContext</h2><p>container나 Pod에 대한 보안 관련 설정을 수행하여 Pod나 Container의 권한을 제한하거나 확장할 수 있다.</p><p>설정 가능한 SecurityContext는 아래와 같다</p><ul><li><strong><code>privileged</code></strong>: 특수 권한 컨테이너 실행</li><li><strong><code>capabilities</code></strong>: capabilities 추가 및 삭제</li><li><strong><code>allowPrivilegeEscalation</code></strong>: 컨테이너 실행 시 상위 프로세스 보다 많은 권한을 부여할 지 여부</li><li><strong><code>readOnlyRootFilesystem</code></strong>: root 파일 시스템을 읽기 전용으로 할지 여부</li><li><strong><code>runAsUser</code></strong>: 실행 사용자</li><li><strong><code>runAsGroup</code></strong>: 실행 그룹</li><li><strong><code>runAsNonRoot</code></strong>: root에서 실행을 거부</li><li><strong><code>seLinuxOptions</code></strong>: SELinux 옵션</li></ul><h4 id="privileged"><a href="#privileged" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>privileged</h4><p>파드 내 특권을 가진 컨테이너를 생성한다. 특수 권한 컨테이너 내부에서 동작하는 프로세스는 호스트와 동등한 권한을 갖게 된다.</p><p>일반적으로 container는 isolation 과 security, 리소스 활용, 호환성 및 이식성 때문에 호스트와 비교해 권한이 제한되어 있다. 이 기능은 레거시 애플리케이션 기능이나 디버깅 등에서 활용될 수 있지만 보안 위험을 증가시키므로 신중한 사용이 고려되어야 한다.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Pod
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> sample<span class="token punctuation">-</span>privileged
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
</span><span class="code-line">      <span class="token atrule key">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.12</span>
</span><span class="code-line">      <span class="token atrule key">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</span><span class="code-line">      <span class="token atrule key">securityContext</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span></code></pre></div><h4 id="capabilities"><a href="#capabilities" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>capabilities</h4><p>privileged 컨테이너는 모든 권한을 호스트와 동일하게 부여하지만, capabilities를 부여하면 권한을 좀 더 세분화하여 부여(add)하거나 제거(drop)할 수 있다.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Pod
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> sample<span class="token punctuation">-</span>capabilities
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
</span><span class="code-line">      <span class="token atrule key">image</span><span class="token punctuation">:</span> masayaaoyama/nginx<span class="token punctuation">:</span>capsh
</span><span class="code-line">      <span class="token atrule key">securityContext</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">capabilities</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token atrule key">add</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;SYS_ADMIN&#x27;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;AUDIT_WRITE&#x27;</span><span class="token punctuation">]</span>
</span></code></pre></div><p>아래 명령어는 컨테이너에서 capsh 명령으로 capability를 확인할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">kubectl <span class="token builtin class-name">exec</span> -it sample-capabilities -- capsh --print <span class="token operator">|</span> <span class="token function">grep</span> Current
</span></code></pre></div><h4 id="readonlyrootfilesystem"><a href="#readonlyrootfilesystem" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>readOnlyRootFilesystem</h4><p>컨테이너 이미지에 포함된 파일 등을 읽기 전용으로 설정한다. 컨테이너가 커널 관련 파일을 변경할 수 없게 만들어 보안성을 향싱시킨다.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Pod
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> sample<span class="token punctuation">-</span>rootfile<span class="token punctuation">-</span>readonly
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> centos<span class="token punctuation">-</span>container
</span><span class="code-line">      <span class="token atrule key">image</span><span class="token punctuation">:</span> centos<span class="token punctuation">:</span><span class="token number">7</span>
</span><span class="code-line">      <span class="token atrule key">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;/bin/sleep&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;3600&#x27;</span><span class="token punctuation">]</span>
</span><span class="code-line">      <span class="token atrule key">securityContext</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span></code></pre></div><p>아래 명령어는 컨테이너에서 /etc/os-release 파일을 변경할 수 없는 것을 확인한다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">kubectl <span class="token builtin class-name">exec</span> -it sample-rootfile-readonly -- <span class="token function">touch</span> /etc/os-release
</span></code></pre></div><h2 id="pod-level-security-context"><a href="#pod-level-security-context" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Pod Level Security Context</h2><p>설정 가능한 SecurityContext는 아래와 같다</p><ul><li><strong><code>runAsUser</code></strong>: 실행할 사용자 uid 지정</li><li><strong><code>runAsGroup</code></strong>: 실행할 그룹 gid 지정</li><li><strong><code>runAsNonRoot</code></strong>: root에서 실행을 거부</li><li><strong><code>supplementalGroups</code></strong>: primary gui에 추가로 부여할 GID 목록을 지정</li><li><strong><code>fsGroup</code></strong>: 파일 시스템 그룹 지정</li><li><strong><code>sysctls</code></strong>: override 할 kernel param 지정</li><li><strong><code>seLinuxOptions</code></strong>: SELinux 옵션</li></ul><h4 id="실행할-사용자-uid-gid-supplementalgroup-지정"><a href="#실행할-사용자-uid-gid-supplementalgroup-지정" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>실행할 사용자 uid, gid, supplementalGroup 지정</h4><p>컨테이너가 실행하는 entrypoint runuser를 변경할 수 있다. 보안을 위해서 기본적으로 root 사용자 외 다른 uid로 지정하는 것이 좋다.</p><p>아래는 uid로 nobody(65534), gid로 nogroup(65534)를 지정했다.</p><p>supplementalGroups은 실행가능한 gid 목록으로 1001, 1002를 추가했다.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Pod
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> sample<span class="token punctuation">-</span>runuser
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">securityContext</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">runAsUser</span><span class="token punctuation">:</span> <span class="token number">65534</span>
</span><span class="code-line">    <span class="token atrule key">runAsGroup</span><span class="token punctuation">:</span> <span class="token number">65534</span>
</span><span class="code-line">    <span class="token atrule key">supplementalGroups</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token number">1001</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token number">1002</span>
</span><span class="code-line">  <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> centos<span class="token punctuation">-</span>container
</span><span class="code-line">      <span class="token atrule key">image</span><span class="token punctuation">:</span> centos<span class="token punctuation">:</span><span class="token number">7</span>
</span><span class="code-line">      <span class="token atrule key">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;/bin/sleep&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;3600&#x27;</span><span class="token punctuation">]</span>
</span></code></pre></div><p>실행하는 사용자 정보 확인</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">kubectl <span class="token builtin class-name">exec</span> -it sample-runuser -- <span class="token function">id</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># sleep 명령어를 실행하고 있는 사용자와 그룹 확인</span>
</span><span class="code-line">kubectl <span class="token builtin class-name">exec</span> -it sample-runuser -- <span class="token function">ps</span> -axo uid,user,gid,group,pid,comm
</span></code></pre></div><h4 id="root-사용자로-실행-제한"><a href="#root-사용자로-실행-제한" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>root 사용자로 실행 제한</h4><p>runAsUser를 변경하지 않고 root로 실행을 거부하도록 하는 설정이다.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Pod
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> sample<span class="token punctuation">-</span>nonroot
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">securityContext</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">  <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
</span><span class="code-line">      <span class="token atrule key">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.12</span>
</span></code></pre></div><p>nginx 이미지는 기본적으로 root 로 실행되므로 runAsNonRoot: true 이면 컨테이너가 정상동작하지 않는다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">kubectl describe pod sample-nonroot
</span></code></pre></div><h4 id="file-system-group-지정"><a href="#file-system-group-지정" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>file system group 지정</h4><p>일반적으로 mount 한 volume의 owner와 group은 root:root 이다. runAsUser로 실행 사용자를 변경하면, 마운트한 볼륨에 권한이 없는 경우가 있다. 이런 경우 마운트하는 볼륨의 그룹을 바꿔주기 위한 기능이다.</p><p>emptyDir같은 Volume 뿐 아니라 PersistenceVolume의 volumeMounts 도 동일하게 적용된다.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Pod
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> sample<span class="token punctuation">-</span>fsgroup
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">securityContext</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">fsGroup</span><span class="token punctuation">:</span> <span class="token number">1001</span>
</span><span class="code-line">  <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.12</span>
</span><span class="code-line">      <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
</span><span class="code-line">      <span class="token atrule key">volumeMounts</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">mountPath</span><span class="token punctuation">:</span> /cache
</span><span class="code-line">          <span class="token atrule key">name</span><span class="token punctuation">:</span> cache<span class="token punctuation">-</span>volume
</span><span class="code-line">  <span class="token atrule key">volumes</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> cache<span class="token punctuation">-</span>volume
</span><span class="code-line">      <span class="token atrule key">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span></code></pre></div><p>mount된 볼륨의 gid 확인하기</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">kubectl <span class="token builtin class-name">exec</span> -it sample-fsgroup -- <span class="token function">ls</span> -ld /cache
</span></code></pre></div><h4 id="sysctl을-사용한-커널-파라미터-설정"><a href="#sysctl을-사용한-커널-파라미터-설정" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>sysctl을 사용한 커널 파라미터 설정</h4><p>커널 파라미터는 성능에 영향을 미치므로 VM의 경우와 마찬가지로 컨테이너에서도 설정해줘야 한다. 이 설정은 Pod-level SecurityContext 이므로 container들 사이에 공유된다.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Pod
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> sample<span class="token punctuation">-</span>sysctl
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">securityContext</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">sysctls</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> net.core.somaxconn
</span><span class="code-line">        <span class="token atrule key">value</span><span class="token punctuation">:</span> <span class="token string">&#x27;12345&#x27;</span>
</span><span class="code-line">  <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> centos<span class="token punctuation">-</span>container
</span><span class="code-line">      <span class="token atrule key">image</span><span class="token punctuation">:</span> centos<span class="token punctuation">:</span><span class="token number">7</span>
</span><span class="code-line">      <span class="token atrule key">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;/bin/sleep&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;3600&#x27;</span><span class="token punctuation">]</span>
</span></code></pre></div><p>커널 파라미터는 safe와 unsafe로 분류되며, 이 맥락에서 safety는 것은 호스트와 커널이 적절하게 분리되어 다른 파드에 영향이 없는 것과 파드가 예상치 못한 리소스를 소비하지 않는 것을 의미한다.</p><p>대부분의 파라미터는 unsafe로 분류된다.</p><p>unsafe한 파라미터를 설정하면, cluster provider가 명시적으로 허용하지 않는 경우 Pod가 정상시작하지 못한다. 그래서 unsafe한 파라미터를 추가해야 할 떄는 k8s node에 있는 kubelet의 옵션에서 명시적으로 지정해야 한다. (managed service 에서는 변경이 어렵다.)</p><p>mount된 볼륨의 gid 확인하기</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token comment"># Status가 SysctlForbidden으로 pod가 정상시작되지 않았다.</span>
</span><span class="code-line">kubectl get pod sample-sysctl
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># net.core.somaxconn 파라미터가 whitelist에 있지 않은 것이 원인이다.</span>
</span><span class="code-line">kubectl describe pod sample-sysctl
</span><span class="code-line">
</span></code></pre></div><p>unsafe 한 파라미터는 강제적으로 변경하려면 아래와 같이 init-container를 사용하는 방법이 있다. container에 privileged: true를 적용하고 init-container 에서 sysctl로 커널 파라미터를 적용하여 컨테이너간에 공유하도록 설정했다.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Pod
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> sample<span class="token punctuation">-</span>sysctl<span class="token punctuation">-</span>initcontainer
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">initContainers</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> initialize<span class="token punctuation">-</span>sysctl
</span><span class="code-line">      <span class="token atrule key">image</span><span class="token punctuation">:</span> busybox<span class="token punctuation">:</span><span class="token number">1.27</span>
</span><span class="code-line">      <span class="token atrule key">command</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> /bin/sh
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">          sysctl -w net.core.somaxconn=12345</span>
</span><span class="code-line">      <span class="token atrule key">securityContext</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">  <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> tools<span class="token punctuation">-</span>container
</span><span class="code-line">      <span class="token atrule key">image</span><span class="token punctuation">:</span> amsy810/tools<span class="token punctuation">:</span>v2.0
</span></code></pre></div></div></div><div id="comment"></div><footer><div class="flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base"><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog/k8s_manifest-ServiceAccount">← <!-- -->K8S manifest - ServiceAccount</a></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog/set-up-k8s-cluster-kubespray-on-virtualbox-ubuntu2204">Setting up a Kubernetes Cluster using Kubespray on VirtualBox with Ubuntu 22.04<!-- --> →</a></div></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:demian11k@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/demian9k"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>demian11k</div><div> • </div><div>© 2023</div><div> • </div><a href="/">demian11k studylog</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var o=Object.create;var i=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var l=a=\u003ei(a,\"__esModule\",{value:!0});var m=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{l(a);for(var c in s)i(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!u.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026i(a,n,{get:()=\u003es[n],enumerable:!(c=d(s,n))||c.enumerable});return a},y=a=\u003ek(l(i(a!=null?o(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=m((w,t)=\u003e{t.exports=_jsx_runtime});var v={};N(v,{default:()=\u003ef,frontmatter:()=\u003eg});var e=y(r()),g={title:\"K8S manifest - SecurityContext\",date:new Date(168567138e4),lastmod:\"2023-06-02\",tags:[\"kubernetes\"],draft:!1,summary:\"\",layout:\"PostSimple\"};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",h1:\"h1\",ul:\"ul\",li:\"li\",strong:\"strong\",code:\"code\",h4:\"h4\",pre:\"pre\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"what-is-privileged-securitycontext-when-we-need-this-what-is-limited-capability-of-pod-or-container-compared-to-host\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#what-is-privileged-securitycontext-when-we-need-this-what-is-limited-capability-of-pod-or-container-compared-to-host\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"what is privileged SecurityContext?, when we need this? what is limited capability of pod or container compared to host\"]}),(0,e.jsx)(n.p,{children:\"A privileged SecurityContext in Kubernetes allows a container to run with extended privileges, essentially bypassing many security restrictions and gaining elevated access within the cluster. When a container is running in privileged mode, it has almost the same privileges and capabilities as the host machine.\"}),(0,e.jsx)(n.p,{children:\"You might need to use privileged SecurityContext in certain scenarios, such as:\"}),(0,e.jsx)(n.p,{children:\"Legacy Applications: Some older applications may require elevated privileges to function properly. They might need direct access to specific system resources or perform operations that are restricted in a non-privileged container. Running such applications in privileged mode can help ensure their proper execution.\"}),(0,e.jsx)(n.p,{children:\"Debugging and Troubleshooting: In certain troubleshooting scenarios, you may need access to low-level system resources or the ability to manipulate network settings. Privileged containers allow you to perform these operations, aiding in debugging and diagnosing issues within the cluster.\"}),(0,e.jsx)(n.p,{children:\"Device Access: Certain devices or hardware components require privileged access to be utilized by containers. Privileged mode allows containers to directly access and control these devices, enabling scenarios like GPU acceleration or direct hardware interaction.\"}),(0,e.jsx)(n.p,{children:\"Despite its potential benefits, using privileged SecurityContext should be approached with caution due to the increased security risks. Running containers in privileged mode essentially removes the isolation and sandboxing provided by Kubernetes, potentially compromising the security and stability of the cluster. Therefore, it is recommended to use privileged mode only when absolutely necessary and ensure that proper security measures are in place.\"}),(0,e.jsx)(n.p,{children:\"When a pod or container is running with limited capabilities compared to the host, it means that the container's privileges and access are restricted. By default, containers in Kubernetes are non-privileged and operate within a secure sandboxed environment, with limited access to the host system. They have restricted access to system resources, such as file systems, network configurations, and device drivers. This helps to enforce the principle of least privilege and prevent containers from performing unauthorized or malicious actions.\"}),(0,e.jsx)(n.p,{children:\"Containers running with limited capabilities have the following restrictions compared to the host:\"}),(0,e.jsx)(n.p,{children:\"File System: Containers typically have their own isolated file system, separate from the host's file system. They cannot access files outside their designated scope, providing a level of isolation and preventing unauthorized access to host system files.\"}),(0,e.jsx)(n.p,{children:\"Network Configuration: Containers have their own network stack and network namespace, isolated from the host's network configuration. They cannot directly modify host network settings or interact with network interfaces outside their own network namespace.\"}),(0,e.jsx)(n.p,{children:\"Device Access: Containers usually have limited access to physical devices or device drivers on the host. They cannot directly access or control hardware devices unless explicitly allowed or passed through using specialized mechanisms like device plugins or passthrough configurations.\"}),(0,e.jsx)(n.p,{children:\"Kernel Capabilities: Containers operate with a restricted set of Linux kernel capabilities, which determine their privileged actions. By default, containers do not have access to sensitive kernel capabilities, preventing them from performing privileged operations that could compromise the host or other containers.\"}),(0,e.jsx)(n.p,{children:\"These limitations ensure that containers run in a secure and isolated manner, reducing the risk of unauthorized actions, privilege escalation, or malicious activities within the Kubernetes cluster.\"}),(0,e.jsxs)(n.h2,{id:\"why-container-should-have-restrictions-compared-to-host\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#why-container-should-have-restrictions-compared-to-host\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"why container should have restrictions compared to host?\"]}),(0,e.jsx)(n.p,{children:\"Containers should have restrictions compared to the host for several important reasons:\"}),(0,e.jsx)(n.p,{children:\"Isolation and Security: Containers provide an additional layer of isolation and security within a host system. By restricting the capabilities of containers, you limit their access to sensitive resources and reduce the risk of unauthorized actions. This isolation prevents containers from interfering with each other or with the host system, reducing the attack surface and mitigating the potential impact of security breaches.\"}),(0,e.jsx)(n.p,{children:\"Resource Utilization: Containers share the underlying host system's resources, such as CPU, memory, and storage. By imposing restrictions on containers, you ensure fair resource allocation and prevent a single container from monopolizing resources or impacting the overall system performance. This allows for efficient utilization of resources across multiple containers running on the same host.\"}),(0,e.jsx)(n.p,{children:\"Principle of Least Privilege: The principle of least privilege is a security best practice that advocates granting the minimum privileges necessary for a system or application to function. By applying restrictions to containers, you enforce this principle and limit their capabilities to only what is required for their intended purpose. This reduces the potential attack surface and minimizes the impact of potential security vulnerabilities.\"}),(0,e.jsx)(n.p,{children:\"Compatibility and Portability: Containers are designed to be portable and compatible across different environments and host systems. By enforcing restrictions on containers, you ensure that they can run in various environments without relying on specific host configurations or dependencies. This enhances the portability and interoperability of containers, allowing them to be deployed consistently across different Kubernetes clusters or container orchestration platforms.\"}),(0,e.jsx)(n.p,{children:\"Stability and Predictability: By restricting container capabilities, you promote stability and predictability within the host system. Containers with limited access to host resources are less likely to cause system instability or conflicts. This ensures that the host system remains reliable and unaffected by the actions of containers, providing a stable environment for other applications and services.\"}),(0,e.jsx)(n.p,{children:\"Overall, restrictions on containers compared to the host promote security, resource efficiency, compatibility, stability, and adherence to the principle of least privilege. By maintaining these restrictions, you establish a secure and controlled environment for running containers, reducing risks and ensuring the overall stability and integrity of your Kubernetes cluster.\"}),(0,e.jsxs)(n.h1,{id:\"securitycontext\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#securitycontext\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"SecurityContext\"]}),(0,e.jsxs)(n.h2,{id:\"container-level-securitycontext\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#container-level-securitycontext\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Container level SecurityContext\"]}),(0,e.jsx)(n.p,{children:\"container\\uB098 Pod\\uC5D0 \\uB300\\uD55C \\uBCF4\\uC548 \\uAD00\\uB828 \\uC124\\uC815\\uC744 \\uC218\\uD589\\uD558\\uC5EC Pod\\uB098 Container\\uC758 \\uAD8C\\uD55C\\uC744 \\uC81C\\uD55C\\uD558\\uAC70\\uB098 \\uD655\\uC7A5\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(n.p,{children:\"\\uC124\\uC815 \\uAC00\\uB2A5\\uD55C SecurityContext\\uB294 \\uC544\\uB798\\uC640 \\uAC19\\uB2E4\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"privileged\"})}),\": \\uD2B9\\uC218 \\uAD8C\\uD55C \\uCEE8\\uD14C\\uC774\\uB108 \\uC2E4\\uD589\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"capabilities\"})}),\": capabilities \\uCD94\\uAC00 \\uBC0F \\uC0AD\\uC81C\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"allowPrivilegeEscalation\"})}),\": \\uCEE8\\uD14C\\uC774\\uB108 \\uC2E4\\uD589 \\uC2DC \\uC0C1\\uC704 \\uD504\\uB85C\\uC138\\uC2A4 \\uBCF4\\uB2E4 \\uB9CE\\uC740 \\uAD8C\\uD55C\\uC744 \\uBD80\\uC5EC\\uD560 \\uC9C0 \\uC5EC\\uBD80\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"readOnlyRootFilesystem\"})}),\": root \\uD30C\\uC77C \\uC2DC\\uC2A4\\uD15C\\uC744 \\uC77D\\uAE30 \\uC804\\uC6A9\\uC73C\\uB85C \\uD560\\uC9C0 \\uC5EC\\uBD80\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"runAsUser\"})}),\": \\uC2E4\\uD589 \\uC0AC\\uC6A9\\uC790\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"runAsGroup\"})}),\": \\uC2E4\\uD589 \\uADF8\\uB8F9\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"runAsNonRoot\"})}),\": root\\uC5D0\\uC11C \\uC2E4\\uD589\\uC744 \\uAC70\\uBD80\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"seLinuxOptions\"})}),\": SELinux \\uC635\\uC158\"]})]}),(0,e.jsxs)(n.h4,{id:\"privileged\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#privileged\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"privileged\"]}),(0,e.jsx)(n.p,{children:\"\\uD30C\\uB4DC \\uB0B4 \\uD2B9\\uAD8C\\uC744 \\uAC00\\uC9C4 \\uCEE8\\uD14C\\uC774\\uB108\\uB97C \\uC0DD\\uC131\\uD55C\\uB2E4. \\uD2B9\\uC218 \\uAD8C\\uD55C \\uCEE8\\uD14C\\uC774\\uB108 \\uB0B4\\uBD80\\uC5D0\\uC11C \\uB3D9\\uC791\\uD558\\uB294 \\uD504\\uB85C\\uC138\\uC2A4\\uB294 \\uD638\\uC2A4\\uD2B8\\uC640 \\uB3D9\\uB4F1\\uD55C \\uAD8C\\uD55C\\uC744 \\uAC16\\uAC8C \\uB41C\\uB2E4.\"}),(0,e.jsx)(n.p,{children:\"\\uC77C\\uBC18\\uC801\\uC73C\\uB85C container\\uB294 isolation \\uACFC security, \\uB9AC\\uC18C\\uC2A4 \\uD65C\\uC6A9, \\uD638\\uD658\\uC131 \\uBC0F \\uC774\\uC2DD\\uC131 \\uB54C\\uBB38\\uC5D0 \\uD638\\uC2A4\\uD2B8\\uC640 \\uBE44\\uAD50\\uD574 \\uAD8C\\uD55C\\uC774 \\uC81C\\uD55C\\uB418\\uC5B4 \\uC788\\uB2E4. \\uC774 \\uAE30\\uB2A5\\uC740 \\uB808\\uAC70\\uC2DC \\uC560\\uD50C\\uB9AC\\uCF00\\uC774\\uC158 \\uAE30\\uB2A5\\uC774\\uB098 \\uB514\\uBC84\\uAE45 \\uB4F1\\uC5D0\\uC11C \\uD65C\\uC6A9\\uB420 \\uC218 \\uC788\\uC9C0\\uB9CC \\uBCF4\\uC548 \\uC704\\uD5D8\\uC744 \\uC99D\\uAC00\\uC2DC\\uD0A4\\uBBC0\\uB85C \\uC2E0\\uC911\\uD55C \\uC0AC\\uC6A9\\uC774 \\uACE0\\uB824\\uB418\\uC5B4\\uC57C \\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Pod\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" sample\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`privileged\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1.12\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containerPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"securityContext\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"privileged\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]})]})}),(0,e.jsxs)(n.h4,{id:\"capabilities\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#capabilities\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"capabilities\"]}),(0,e.jsx)(n.p,{children:\"privileged \\uCEE8\\uD14C\\uC774\\uB108\\uB294 \\uBAA8\\uB4E0 \\uAD8C\\uD55C\\uC744 \\uD638\\uC2A4\\uD2B8\\uC640 \\uB3D9\\uC77C\\uD558\\uAC8C \\uBD80\\uC5EC\\uD558\\uC9C0\\uB9CC, capabilities\\uB97C \\uBD80\\uC5EC\\uD558\\uBA74 \\uAD8C\\uD55C\\uC744 \\uC880 \\uB354 \\uC138\\uBD84\\uD654\\uD558\\uC5EC \\uBD80\\uC5EC(add)\\uD558\\uAC70\\uB098 \\uC81C\\uAC70(drop)\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Pod\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" sample\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`capabilities\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" masayaaoyama/nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`capsh\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"securityContext\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"capabilities\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"add\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'SYS_ADMIN'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"drop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'AUDIT_WRITE'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uC544\\uB798 \\uBA85\\uB839\\uC5B4\\uB294 \\uCEE8\\uD14C\\uC774\\uB108\\uC5D0\\uC11C capsh \\uBA85\\uB839\\uC73C\\uB85C capability\\uB97C \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -it sample-capabilities -- capsh --print \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"grep\"}),` Current\n`]})})}),(0,e.jsxs)(n.h4,{id:\"readonlyrootfilesystem\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#readonlyrootfilesystem\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"readOnlyRootFilesystem\"]}),(0,e.jsx)(n.p,{children:\"\\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uC5D0 \\uD3EC\\uD568\\uB41C \\uD30C\\uC77C \\uB4F1\\uC744 \\uC77D\\uAE30 \\uC804\\uC6A9\\uC73C\\uB85C \\uC124\\uC815\\uD55C\\uB2E4. \\uCEE8\\uD14C\\uC774\\uB108\\uAC00 \\uCEE4\\uB110 \\uAD00\\uB828 \\uD30C\\uC77C\\uC744 \\uBCC0\\uACBD\\uD560 \\uC218 \\uC5C6\\uAC8C \\uB9CC\\uB4E4\\uC5B4 \\uBCF4\\uC548\\uC131\\uC744 \\uD5A5\\uC2F1\\uC2DC\\uD0A8\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Pod\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" sample\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"rootfile\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`readonly\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" centos\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" centos\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"7\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"command\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'/bin/sleep'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'3600'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"securityContext\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"readOnlyRootFilesystem\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uC544\\uB798 \\uBA85\\uB839\\uC5B4\\uB294 \\uCEE8\\uD14C\\uC774\\uB108\\uC5D0\\uC11C /etc/os-release \\uD30C\\uC77C\\uC744 \\uBCC0\\uACBD\\uD560 \\uC218 \\uC5C6\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -it sample-rootfile-readonly -- \",(0,e.jsx)(n.span,{className:\"token function\",children:\"touch\"}),` /etc/os-release\n`]})})}),(0,e.jsxs)(n.h2,{id:\"pod-level-security-context\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#pod-level-security-context\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Pod Level Security Context\"]}),(0,e.jsx)(n.p,{children:\"\\uC124\\uC815 \\uAC00\\uB2A5\\uD55C SecurityContext\\uB294 \\uC544\\uB798\\uC640 \\uAC19\\uB2E4\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"runAsUser\"})}),\": \\uC2E4\\uD589\\uD560 \\uC0AC\\uC6A9\\uC790 uid \\uC9C0\\uC815\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"runAsGroup\"})}),\": \\uC2E4\\uD589\\uD560 \\uADF8\\uB8F9 gid \\uC9C0\\uC815\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"runAsNonRoot\"})}),\": root\\uC5D0\\uC11C \\uC2E4\\uD589\\uC744 \\uAC70\\uBD80\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"supplementalGroups\"})}),\": primary gui\\uC5D0 \\uCD94\\uAC00\\uB85C \\uBD80\\uC5EC\\uD560 GID \\uBAA9\\uB85D\\uC744 \\uC9C0\\uC815\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"fsGroup\"})}),\": \\uD30C\\uC77C \\uC2DC\\uC2A4\\uD15C \\uADF8\\uB8F9 \\uC9C0\\uC815\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"sysctls\"})}),\": override \\uD560 kernel param \\uC9C0\\uC815\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"seLinuxOptions\"})}),\": SELinux \\uC635\\uC158\"]})]}),(0,e.jsxs)(n.h4,{id:\"\\uC2E4\\uD589\\uD560-\\uC0AC\\uC6A9\\uC790-uid-gid-supplementalgroup-\\uC9C0\\uC815\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#\\uC2E4\\uD589\\uD560-\\uC0AC\\uC6A9\\uC790-uid-gid-supplementalgroup-\\uC9C0\\uC815\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uC2E4\\uD589\\uD560 \\uC0AC\\uC6A9\\uC790 uid, gid, supplementalGroup \\uC9C0\\uC815\"]}),(0,e.jsx)(n.p,{children:\"\\uCEE8\\uD14C\\uC774\\uB108\\uAC00 \\uC2E4\\uD589\\uD558\\uB294 entrypoint runuser\\uB97C \\uBCC0\\uACBD\\uD560 \\uC218 \\uC788\\uB2E4. \\uBCF4\\uC548\\uC744 \\uC704\\uD574\\uC11C \\uAE30\\uBCF8\\uC801\\uC73C\\uB85C root \\uC0AC\\uC6A9\\uC790 \\uC678 \\uB2E4\\uB978 uid\\uB85C \\uC9C0\\uC815\\uD558\\uB294 \\uAC83\\uC774 \\uC88B\\uB2E4.\"}),(0,e.jsx)(n.p,{children:\"\\uC544\\uB798\\uB294 uid\\uB85C nobody(65534), gid\\uB85C nogroup(65534)\\uB97C \\uC9C0\\uC815\\uD588\\uB2E4.\"}),(0,e.jsx)(n.p,{children:\"supplementalGroups\\uC740 \\uC2E4\\uD589\\uAC00\\uB2A5\\uD55C gid \\uBAA9\\uB85D\\uC73C\\uB85C 1001, 1002\\uB97C \\uCD94\\uAC00\\uD588\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Pod\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" sample\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`runuser\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"securityContext\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"runAsUser\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"65534\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"runAsGroup\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"65534\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"supplementalGroups\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1001\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1002\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" centos\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" centos\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"7\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"command\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'/bin/sleep'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'3600'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uC2E4\\uD589\\uD558\\uB294 \\uC0AC\\uC6A9\\uC790 \\uC815\\uBCF4 \\uD655\\uC778\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -it sample-runuser -- \",(0,e.jsx)(n.span,{className:\"token function\",children:\"id\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# sleep \\uBA85\\uB839\\uC5B4\\uB97C \\uC2E4\\uD589\\uD558\\uACE0 \\uC788\\uB294 \\uC0AC\\uC6A9\\uC790\\uC640 \\uADF8\\uB8F9 \\uD655\\uC778\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -it sample-runuser -- \",(0,e.jsx)(n.span,{className:\"token function\",children:\"ps\"}),` -axo uid,user,gid,group,pid,comm\n`]})]})}),(0,e.jsxs)(n.h4,{id:\"root-\\uC0AC\\uC6A9\\uC790\\uB85C-\\uC2E4\\uD589-\\uC81C\\uD55C\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#root-\\uC0AC\\uC6A9\\uC790\\uB85C-\\uC2E4\\uD589-\\uC81C\\uD55C\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"root \\uC0AC\\uC6A9\\uC790\\uB85C \\uC2E4\\uD589 \\uC81C\\uD55C\"]}),(0,e.jsx)(n.p,{children:\"runAsUser\\uB97C \\uBCC0\\uACBD\\uD558\\uC9C0 \\uC54A\\uACE0 root\\uB85C \\uC2E4\\uD589\\uC744 \\uAC70\\uBD80\\uD558\\uB3C4\\uB85D \\uD558\\uB294 \\uC124\\uC815\\uC774\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Pod\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" sample\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nonroot\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"securityContext\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"runAsNonRoot\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1.12\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"nginx \\uC774\\uBBF8\\uC9C0\\uB294 \\uAE30\\uBCF8\\uC801\\uC73C\\uB85C root \\uB85C \\uC2E4\\uD589\\uB418\\uBBC0\\uB85C runAsNonRoot: true \\uC774\\uBA74 \\uCEE8\\uD14C\\uC774\\uB108\\uAC00 \\uC815\\uC0C1\\uB3D9\\uC791\\uD558\\uC9C0 \\uC54A\\uB294\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`kubectl describe pod sample-nonroot\n`})})}),(0,e.jsxs)(n.h4,{id:\"file-system-group-\\uC9C0\\uC815\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#file-system-group-\\uC9C0\\uC815\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"file system group \\uC9C0\\uC815\"]}),(0,e.jsx)(n.p,{children:\"\\uC77C\\uBC18\\uC801\\uC73C\\uB85C mount \\uD55C volume\\uC758 owner\\uC640 group\\uC740 root:root \\uC774\\uB2E4. runAsUser\\uB85C \\uC2E4\\uD589 \\uC0AC\\uC6A9\\uC790\\uB97C \\uBCC0\\uACBD\\uD558\\uBA74, \\uB9C8\\uC6B4\\uD2B8\\uD55C \\uBCFC\\uB968\\uC5D0 \\uAD8C\\uD55C\\uC774 \\uC5C6\\uB294 \\uACBD\\uC6B0\\uAC00 \\uC788\\uB2E4. \\uC774\\uB7F0 \\uACBD\\uC6B0 \\uB9C8\\uC6B4\\uD2B8\\uD558\\uB294 \\uBCFC\\uB968\\uC758 \\uADF8\\uB8F9\\uC744 \\uBC14\\uAFD4\\uC8FC\\uAE30 \\uC704\\uD55C \\uAE30\\uB2A5\\uC774\\uB2E4.\"}),(0,e.jsx)(n.p,{children:\"emptyDir\\uAC19\\uC740 Volume \\uBFD0 \\uC544\\uB2C8\\uB77C PersistenceVolume\\uC758 volumeMounts \\uB3C4 \\uB3D9\\uC77C\\uD558\\uAC8C \\uC801\\uC6A9\\uB41C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Pod\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" sample\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`fsgroup\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"securityContext\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"fsGroup\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1001\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1.12\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumeMounts\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"mountPath\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /cache\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" cache\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`volume\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" cache\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`volume\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"emptyDir\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"mount\\uB41C \\uBCFC\\uB968\\uC758 gid \\uD655\\uC778\\uD558\\uAE30\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -it sample-fsgroup -- \",(0,e.jsx)(n.span,{className:\"token function\",children:\"ls\"}),` -ld /cache\n`]})})}),(0,e.jsxs)(n.h4,{id:\"sysctl\\uC744-\\uC0AC\\uC6A9\\uD55C-\\uCEE4\\uB110-\\uD30C\\uB77C\\uBBF8\\uD130-\\uC124\\uC815\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#sysctl\\uC744-\\uC0AC\\uC6A9\\uD55C-\\uCEE4\\uB110-\\uD30C\\uB77C\\uBBF8\\uD130-\\uC124\\uC815\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"sysctl\\uC744 \\uC0AC\\uC6A9\\uD55C \\uCEE4\\uB110 \\uD30C\\uB77C\\uBBF8\\uD130 \\uC124\\uC815\"]}),(0,e.jsx)(n.p,{children:\"\\uCEE4\\uB110 \\uD30C\\uB77C\\uBBF8\\uD130\\uB294 \\uC131\\uB2A5\\uC5D0 \\uC601\\uD5A5\\uC744 \\uBBF8\\uCE58\\uBBC0\\uB85C VM\\uC758 \\uACBD\\uC6B0\\uC640 \\uB9C8\\uCC2C\\uAC00\\uC9C0\\uB85C \\uCEE8\\uD14C\\uC774\\uB108\\uC5D0\\uC11C\\uB3C4 \\uC124\\uC815\\uD574\\uC918\\uC57C \\uD55C\\uB2E4. \\uC774 \\uC124\\uC815\\uC740 Pod-level SecurityContext \\uC774\\uBBC0\\uB85C container\\uB4E4 \\uC0AC\\uC774\\uC5D0 \\uACF5\\uC720\\uB41C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Pod\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" sample\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`sysctl\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"securityContext\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"sysctls\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` net.core.somaxconn\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"value\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'12345'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" centos\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" centos\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"7\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"command\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'/bin/sleep'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'3600'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uCEE4\\uB110 \\uD30C\\uB77C\\uBBF8\\uD130\\uB294 safe\\uC640 unsafe\\uB85C \\uBD84\\uB958\\uB418\\uBA70, \\uC774 \\uB9E5\\uB77D\\uC5D0\\uC11C safety\\uB294 \\uAC83\\uC740 \\uD638\\uC2A4\\uD2B8\\uC640 \\uCEE4\\uB110\\uC774 \\uC801\\uC808\\uD558\\uAC8C \\uBD84\\uB9AC\\uB418\\uC5B4 \\uB2E4\\uB978 \\uD30C\\uB4DC\\uC5D0 \\uC601\\uD5A5\\uC774 \\uC5C6\\uB294 \\uAC83\\uACFC \\uD30C\\uB4DC\\uAC00 \\uC608\\uC0C1\\uCE58 \\uBABB\\uD55C \\uB9AC\\uC18C\\uC2A4\\uB97C \\uC18C\\uBE44\\uD558\\uC9C0 \\uC54A\\uB294 \\uAC83\\uC744 \\uC758\\uBBF8\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.p,{children:\"\\uB300\\uBD80\\uBD84\\uC758 \\uD30C\\uB77C\\uBBF8\\uD130\\uB294 unsafe\\uB85C \\uBD84\\uB958\\uB41C\\uB2E4.\"}),(0,e.jsx)(n.p,{children:\"unsafe\\uD55C \\uD30C\\uB77C\\uBBF8\\uD130\\uB97C \\uC124\\uC815\\uD558\\uBA74, cluster provider\\uAC00 \\uBA85\\uC2DC\\uC801\\uC73C\\uB85C \\uD5C8\\uC6A9\\uD558\\uC9C0 \\uC54A\\uB294 \\uACBD\\uC6B0 Pod\\uAC00 \\uC815\\uC0C1\\uC2DC\\uC791\\uD558\\uC9C0 \\uBABB\\uD55C\\uB2E4. \\uADF8\\uB798\\uC11C unsafe\\uD55C \\uD30C\\uB77C\\uBBF8\\uD130\\uB97C \\uCD94\\uAC00\\uD574\\uC57C \\uD560 \\uB584\\uB294 k8s node\\uC5D0 \\uC788\\uB294 kubelet\\uC758 \\uC635\\uC158\\uC5D0\\uC11C \\uBA85\\uC2DC\\uC801\\uC73C\\uB85C \\uC9C0\\uC815\\uD574\\uC57C \\uD55C\\uB2E4. (managed service \\uC5D0\\uC11C\\uB294 \\uBCC0\\uACBD\\uC774 \\uC5B4\\uB835\\uB2E4.)\"}),(0,e.jsx)(n.p,{children:\"mount\\uB41C \\uBCFC\\uB968\\uC758 gid \\uD655\\uC778\\uD558\\uAE30\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Status\\uAC00 SysctlForbidden\\uC73C\\uB85C pod\\uAC00 \\uC815\\uC0C1\\uC2DC\\uC791\\uB418\\uC9C0 \\uC54A\\uC558\\uB2E4.\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kubectl get pod sample-sysctl\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# net.core.somaxconn \\uD30C\\uB77C\\uBBF8\\uD130\\uAC00 whitelist\\uC5D0 \\uC788\\uC9C0 \\uC54A\\uC740 \\uAC83\\uC774 \\uC6D0\\uC778\\uC774\\uB2E4.\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kubectl describe pod sample-sysctl\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`})]})}),(0,e.jsx)(n.p,{children:\"unsafe \\uD55C \\uD30C\\uB77C\\uBBF8\\uD130\\uB294 \\uAC15\\uC81C\\uC801\\uC73C\\uB85C \\uBCC0\\uACBD\\uD558\\uB824\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC774 init-container\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294 \\uBC29\\uBC95\\uC774 \\uC788\\uB2E4. container\\uC5D0 privileged: true\\uB97C \\uC801\\uC6A9\\uD558\\uACE0 init-container \\uC5D0\\uC11C sysctl\\uB85C \\uCEE4\\uB110 \\uD30C\\uB77C\\uBBF8\\uD130\\uB97C \\uC801\\uC6A9\\uD558\\uC5EC \\uCEE8\\uD14C\\uC774\\uB108\\uAC04\\uC5D0 \\uACF5\\uC720\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uD588\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Pod\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" sample\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"sysctl\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`initcontainer\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"initContainers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" initialize\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`sysctl\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" busybox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1.27\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"command\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),` /bin/sh\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`c\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"          sysctl -w net.core.somaxconn=12345\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"securityContext\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"privileged\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" tools\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" amsy810/tools\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`v2.0\n`]})]})})]})}}var f=b;return v;})();\n;return Component;","toc":[{"value":"what is privileged SecurityContext?, when we need this? what is limited capability of pod or container compared to host","url":"#what-is-privileged-securitycontext-when-we-need-this-what-is-limited-capability-of-pod-or-container-compared-to-host","depth":2},{"value":"why container should have restrictions compared to host?","url":"#why-container-should-have-restrictions-compared-to-host","depth":2},{"value":"SecurityContext","url":"#securitycontext","depth":1},{"value":"Container level SecurityContext","url":"#container-level-securitycontext","depth":2},{"value":"privileged","url":"#privileged","depth":4},{"value":"capabilities","url":"#capabilities","depth":4},{"value":"readOnlyRootFilesystem","url":"#readonlyrootfilesystem","depth":4},{"value":"Pod Level Security Context","url":"#pod-level-security-context","depth":2},{"value":"실행할 사용자 uid, gid, supplementalGroup 지정","url":"#실행할-사용자-uid-gid-supplementalgroup-지정","depth":4},{"value":"root 사용자로 실행 제한","url":"#root-사용자로-실행-제한","depth":4},{"value":"file system group 지정","url":"#file-system-group-지정","depth":4},{"value":"sysctl을 사용한 커널 파라미터 설정","url":"#sysctl을-사용한-커널-파라미터-설정","depth":4}],"frontMatter":{"readingTime":{"text":"11 min read","minutes":10.42,"time":625200,"words":2084},"slug":"k8s_manifest-SecurityContext","fileName":"k8s_manifest-SecurityContext.mdx","title":"K8S manifest - SecurityContext","date":"2023-06-02T02:03:00.000Z","lastmod":"2023-06-02","tags":["kubernetes"],"draft":false,"summary":"","layout":"PostSimple"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.155,"time":9300,"words":31},"slug":["default"],"fileName":"default.md","name":"demian11k","avatar":"/static/images/avatar.png","email":"demian11k@gmail.com","github":"https://github.com/demian9k","date":null}],"prev":{"title":"K8S manifest - ServiceAccount","date":"2023-06-02T02:03:00.000Z","lastmod":"2023-06-02","tags":["kubernetes"],"draft":false,"summary":"","layout":"PostSimple","slug":"k8s_manifest-ServiceAccount"},"next":{"title":"Setting up a Kubernetes Cluster using Kubespray on VirtualBox with Ubuntu 22.04","date":"2023-06-04T02:02:11.000Z","lastmod":"2023-06-04","tags":["kubernetes","ubuntu","virtualbox"],"draft":false,"summary":"","layout":"PostSimple","canonicalUrl":"https://demian9k.github.io/blog/set-up-k8s-cluster-kubespray-on-virtualbox-ubuntu2204/","slug":"set-up-k8s-cluster-kubespray-on-virtualbox-ubuntu2204"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["k8s_manifest-SecurityContext"]},"buildId":"_epZdIX6LUAs-N565XCV9","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>