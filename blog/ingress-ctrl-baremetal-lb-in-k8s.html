<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Hands-On Example: Ingress and Bare Metal Load Balancer in Kubernetes</title><meta name="robots" content="follow, index"/><meta name="description" content=""/><meta property="og:url" content="https://demian9k.github.io/blog/ingress-ctrl-baremetal-lb-in-k8s"/><meta property="og:type" content="article"/><meta property="og:site_name" content="demian11k studylog"/><meta property="og:description" content=""/><meta property="og:title" content="Hands-On Example: Ingress and Bare Metal Load Balancer in Kubernetes"/><meta property="og:image" content="https://demian9k.github.io/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Hands-On Example: Ingress and Bare Metal Load Balancer in Kubernetes"/><meta name="twitter:description" content=""/><meta name="twitter:image" content="https://demian9k.github.io/static/images/twitter-card.png"/><link rel="canonical" href="https://demian9k.github.io/blog/ingress-ctrl-baremetal-lb-in-k8s/"/><meta property="article:published_time" content="2023-06-05T00:00:00.000Z"/><meta property="article:modified_time" content="2023-06-05T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://demian9k.github.io/blog/ingress-ctrl-baremetal-lb-in-k8s"
  },
  "headline": "Hands-On Example: Ingress and Bare Metal Load Balancer in Kubernetes",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://demian9k.github.io/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2023-06-05T00:00:00.000Z",
  "dateModified": "2023-06-05T00:00:00.000Z",
  "author": {
    "@type": "Person",
    "name": "demian11k"
  },
  "publisher": {
    "@type": "Organization",
    "name": "demian11k",
    "logo": {
      "@type": "ImageObject",
      "url": "https://demian9k.github.io/static/images/logo.png"
    }
  },
  "description": ""
}</script><meta name="next-head-count" content="21"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/9da9539fac7f1ee9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9da9539fac7f1ee9.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-1667cddafac2eea3.js" defer=""></script><script src="/_next/static/chunks/main-bfc1a3b6dd286443.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e097d8b875e64e46.js" defer=""></script><script src="/_next/static/chunks/140-77b8ab5a870d524b.js" defer=""></script><script src="/_next/static/chunks/574-40cb695d6b511631.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-48fd063b43fdbe6a.js" defer=""></script><script src="/_next/static/R1cpZtUWE2mFLIblfb-kJ/_buildManifest.js" defer=""></script><script src="/_next/static/R1cpZtUWE2mFLIblfb-kJ/_ssgManifest.js" defer=""></script><script src="/_next/static/R1cpZtUWE2mFLIblfb-kJ/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="demian11k.studylog" href="/"><div class="flex items-center justify-between"><div class="mr-3"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2740%27%20height=%2740%27/%3e"/></span><img alt="A" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="rounded-full object-cover object-center md:h-36 lg:h-48" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="A" srcSet="/_next/static/media/demian_avatar_logo.c12b9855.png?imwidth=48 1x, /_next/static/media/demian_avatar_logo.c12b9855.png?imwidth=96 2x" src="/_next/static/media/demian_avatar_logo.c12b9855.png?imwidth=96" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="rounded-full object-cover object-center md:h-36 lg:h-48" loading="lazy"/></noscript></span></div><div class="hidden h-6 text-2xl font-semibold sm:block">demian11k.studylog</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div><header><div class="space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700"><dl><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-06-05T00:00:00.000Z">June 5, 2023</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Hands-On Example: Ingress and Bare Metal Load Balancer in Kubernetes</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0 " style="grid-template-rows:auto 1fr"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>이 문서는 Production level의 쿠버네티스 클러스터에서 사용되는 Resource인 Ingress 와 LoadBalancer(Service)를 사용하여 클러스터 외부에서 실제 containerized app으로 전달되기 까지의 과정의 configuration을 서술한다.</p><p>모든 설정이 정상적으로 완료되면 요청의 흐름은 아래 순서대로 움직인다.<br/>LoadBalancer -&gt; Ingress-Controller -&gt; NodePort Service -&gt; Deployment -&gt; Pod -&gt; Container</p><p>테스트 환경은 VirtualBox로 구성된 Linux VM 3개 노드이며 아래처럼 구성된다.</p><ul><li>Node1 : 192.168.100.1(Control-plane)</li><li>Node2 : 192.168.100.2(Control-plane)</li><li>Node3 : 192.168.100.3</li></ul><p>그리고 테스트를 위한 외부 호스트는 192.168.100.100 IP를 갖고 해당 노드와 통신이 가능한 host computer(windows 10) 이다.<br/>guest OS와 host는 VirtualBox의 192.168.100.0/24 network 범위 안에 있는 장치들이다.</p><h3 id="1-apply-deployment-for-app"><a href="#1-apply-deployment-for-app" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>1. Apply Deployment for App</h3><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> apps/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Deployment
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> hello<span class="token punctuation">-</span>world
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">selector</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">matchLabels</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">run</span><span class="token punctuation">:</span> load<span class="token punctuation">-</span>balancer<span class="token punctuation">-</span>example
</span><span class="code-line">  <span class="token atrule key">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
</span><span class="code-line">  <span class="token atrule key">template</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">run</span><span class="token punctuation">:</span> load<span class="token punctuation">-</span>balancer<span class="token punctuation">-</span>example
</span><span class="code-line">    <span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> hello<span class="token punctuation">-</span>world
</span><span class="code-line">          <span class="token atrule key">image</span><span class="token punctuation">:</span> gcr.io/google<span class="token punctuation">-</span>samples/node<span class="token punctuation">-</span>hello<span class="token punctuation">:</span><span class="token number">1.0</span> <span class="token comment">#이미지는 /로 요청했을 때 &quot;Hello Kubernetes&quot; 문자열을 응답하는 서버이다.</span>
</span><span class="code-line">          <span class="token atrule key">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</span><span class="code-line">              <span class="token atrule key">protocol</span><span class="token punctuation">:</span> TCP
</span></code></pre></div><h3 id="2-expose-nodeport-service"><a href="#2-expose-nodeport-service" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>2. Expose NodePort Service</h3><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token comment"># kubectl expose deployment hello-world --type=NodePort --name=example-service</span>
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Service
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>service
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> default
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">nodePort</span><span class="token punctuation">:</span> <span class="token number">31349</span>
</span><span class="code-line">      <span class="token atrule key">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</span><span class="code-line">      <span class="token atrule key">protocol</span><span class="token punctuation">:</span> TCP
</span><span class="code-line">      <span class="token atrule key">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</span><span class="code-line">  <span class="token atrule key">selector</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">run</span><span class="token punctuation">:</span> load<span class="token punctuation">-</span>balancer<span class="token punctuation">-</span>example
</span><span class="code-line">  <span class="token atrule key">type</span><span class="token punctuation">:</span> NodePort
</span></code></pre></div><h4 id="testing-nodeport"><a href="#testing-nodeport" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>testing NodePort</h4><p>클러스터 외부에서 &lt;node1 ip&gt;:&lt;nodePort&gt; 로 테스트</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token function">curl</span> <span class="token number">192.168</span>.100.1:31349
</span><span class="code-line">Hello Kubernetes<span class="token operator">!</span>
</span></code></pre></div><h3 id="apply-ingress-controller-loadbalancer"><a href="#apply-ingress-controller-loadbalancer" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Apply Ingress-Controller, LoadBalancer</h3><p>nginx-ingress-controller, metalLB 설치</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token comment">#ingress-nginx</span>
</span><span class="code-line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.8.0/deploy/static/provider/cloud/deploy.yaml
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#metalLB</span>
</span><span class="code-line">kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.13.10/config/manifests/metallb-native.yaml
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#check metalLB resources</span>
</span><span class="code-line">demian@node1:~/metallb$ <span class="token function">sudo</span> kubectl get all -n metallb-system
</span><span class="code-line">NAME                              READY   STATUS    RESTARTS      AGE
</span><span class="code-line">pod/controller-5fd797fbf7-plr77   <span class="token number">1</span>/1     Running   <span class="token number">0</span>             158m
</span><span class="code-line">pod/speaker-6wvmj                 <span class="token number">1</span>/1     Running   <span class="token number">0</span>             139m
</span><span class="code-line">pod/speaker-bq5tv                 <span class="token number">1</span>/1     Running   <span class="token number">1</span> <span class="token punctuation">(</span>13m ago<span class="token punctuation">)</span>   158m
</span><span class="code-line">pod/speaker-s5nxl                 <span class="token number">1</span>/1     Running   <span class="token number">0</span>             158m
</span><span class="code-line">
</span><span class="code-line">NAME                      TYPE        CLUSTER-IP    EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
</span><span class="code-line">service/webhook-service   ClusterIP   <span class="token number">10.233</span>.7.27   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP   158m
</span><span class="code-line">
</span><span class="code-line">NAME                     DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
</span><span class="code-line">daemonset.apps/speaker   <span class="token number">2</span>         <span class="token number">2</span>         <span class="token number">2</span>       <span class="token number">2</span>            <span class="token number">2</span>           kubernetes.io/os<span class="token operator">=</span>linux   158m
</span><span class="code-line">
</span><span class="code-line">NAME                         READY   UP-TO-DATE   AVAILABLE   AGE
</span><span class="code-line">deployment.apps/controller   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           158m
</span><span class="code-line">
</span><span class="code-line">NAME                                    DESIRED   CURRENT   READY   AGE
</span><span class="code-line">replicaset.apps/controller-5fd797fbf7   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       158m
</span></code></pre></div><h3 id="apply-l2-metallb-customresources"><a href="#apply-l2-metallb-customresources" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Apply L2 MetalLB CustomResources</h3><p>metalLB에서 지원하는 2가지의 external network 연결 방법(L2(ARP), L3(BGP)) 중 Layer2에서 advertise 하는 방법을 사용하여 LoadBalancer에서 ingress-controller에 할당할 external ip address pool 및 L2Advertisement 리소스를 생성한다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> metallb.io/v1beta1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> IPAddressPool
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> first<span class="token punctuation">-</span>pool
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">addresses</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> 192.168.100.10<span class="token punctuation">-</span>192.168.100.99
</span><span class="code-line"><span class="token punctuation">---</span>
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> metallb.io/v1beta1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> L2Advertisement
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>network<span class="token punctuation">-</span>l2
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">ipAddressPools</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> first<span class="token punctuation">-</span>pool
</span></code></pre></div><h4 id="metallb-리소스-적용-확인"><a href="#metallb-리소스-적용-확인" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>metalLB 리소스 적용 확인</h4><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">demian@node1:~/metallb$ <span class="token function">sudo</span> kubectl get IPAddressPool,L2Advertisement -n metallb-system
</span><span class="code-line">NAME                                  AUTO ASSIGN   AVOID BUGGY IPS   ADDRESSES
</span><span class="code-line">ipaddresspool.metallb.io/first-pool   <span class="token boolean">true</span>          <span class="token boolean">false</span>             <span class="token punctuation">[</span><span class="token string">&quot;192.168.100.10-192.168.100.99&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">NAME                                       IPADDRESSPOOLS   IPADDRESSPOOL SELECTORS   INTERFACES
</span><span class="code-line">l2advertisement.metallb.io/my-network-l2   <span class="token punctuation">[</span><span class="token string">&quot;first-pool&quot;</span><span class="token punctuation">]</span>
</span></code></pre></div><h4 id="lb에-의해-ingress-controller의-external-ip에-할당-확인"><a href="#lb에-의해-ingress-controller의-external-ip에-할당-확인" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>LB에 의해 ingress-controller의 EXTERNAL-IP에 할당 확인</h4><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">demian@node1:~/metallb$ <span class="token function">sudo</span> kubectl get all -n ingress-nginx
</span><span class="code-line">NAME                                            READY   STATUS      RESTARTS   AGE
</span><span class="code-line">pod/ingress-nginx-admission-create-sg4zf        <span class="token number">0</span>/1     Completed   <span class="token number">0</span>          170m
</span><span class="code-line">pod/ingress-nginx-admission-patch-246vx         <span class="token number">0</span>/1     Completed   <span class="token number">1</span>          170m
</span><span class="code-line">pod/ingress-nginx-controller-7d98bbddbd-hwm2n   <span class="token number">1</span>/1     Running     <span class="token number">0</span>          170m
</span><span class="code-line">
</span><span class="code-line">NAME                                         TYPE           CLUSTER-IP     EXTERNAL-IP      PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                      AGE
</span><span class="code-line">service/ingress-nginx-controller             LoadBalancer   <span class="token number">10.233</span>.2.130   <span class="token number">192.168</span>.100.10   <span class="token number">80</span>:32347/TCP,443:32404/TCP   170m
</span><span class="code-line">service/ingress-nginx-controller-admission   ClusterIP      <span class="token number">10.233</span>.49.33   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token number">443</span>/TCP                      170m
</span><span class="code-line">
</span><span class="code-line">NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
</span><span class="code-line">deployment.apps/ingress-nginx-controller   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           170m
</span><span class="code-line">
</span><span class="code-line">NAME                                                  DESIRED   CURRENT   READY   AGE
</span><span class="code-line">replicaset.apps/ingress-nginx-controller-7d98bbddbd   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       170m
</span><span class="code-line">
</span><span class="code-line">NAME                                       COMPLETIONS   DURATION   AGE
</span><span class="code-line">job.batch/ingress-nginx-admission-create   <span class="token number">1</span>/1           4s         170m
</span><span class="code-line">job.batch/ingress-nginx-admission-patch    <span class="token number">1</span>/1           5s         170m
</span></code></pre></div><h3 id="ingress-리소스-적용"><a href="#ingress-리소스-적용" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Ingress 리소스 적용</h3><p>아래 Ingress는 ingressClassName의 값으로 <code>nginx</code> 를 설정한다. 이전 단계에서 구성한 nginx-ingress-controller manifest 중 IngressClass의 metadata.name과 동일하게 하여 Ingress가 ingress-controller로 nginx를 사용할 것임을 명시한다.</p><p>Ingress 리소스는 Ingress-Controller가 사용하는 정책을 정의한다. 아래는 rules에서 /hello로 들어오는 요청을 example-service의 8080 포트로 라우팅하도록 명시하였다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Ingress
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> hello<span class="token punctuation">-</span>ingress
</span><span class="code-line">  <span class="token atrule key">annotations</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">nginx.ingress.kubernetes.io/rewrite-target</span><span class="token punctuation">:</span> /
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">ingressClassName</span><span class="token punctuation">:</span> nginx
</span><span class="code-line">  <span class="token atrule key">rules</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">http</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">paths</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> <span class="token atrule key">path</span><span class="token punctuation">:</span> /hello
</span><span class="code-line">            <span class="token atrule key">pathType</span><span class="token punctuation">:</span> Prefix
</span><span class="code-line">            <span class="token atrule key">backend</span><span class="token punctuation">:</span>
</span><span class="code-line">              <span class="token atrule key">service</span><span class="token punctuation">:</span>
</span><span class="code-line">                <span class="token atrule key">name</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>service
</span><span class="code-line">                <span class="token atrule key">port</span><span class="token punctuation">:</span>
</span><span class="code-line">                  <span class="token atrule key">number</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</span></code></pre></div><p>아래는 ingress-nginx-controller manifest 중 하나인 IngressClass 이다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> IngressClass
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.8.0
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">controller</span><span class="token punctuation">:</span> k8s.io/ingress<span class="token punctuation">-</span>nginx
</span></code></pre></div><h4 id="클러스터-외부에서-ingress-external-ip로-테스트"><a href="#클러스터-외부에서-ingress-external-ip로-테스트" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>클러스터 외부에서 ingress external ip로 테스트</h4><p>Ingress까지 구성하면 아래 순서대로 요청이 흐르도록 구성된 것이다.<br/>LoadBalancer -&gt; Ingress-Controller -&gt; NodePort Service -&gt; Deployment -&gt; Pod -&gt; Container<br/>이제 클러스터 외부에서 LB를 통해 192.168.100.10에 접근 가능해졌으므로 아래와 같이 테스트하면 성공한다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token function">curl</span> <span class="token number">192.168</span>.100.10/hello
</span><span class="code-line">Hello Kubernetes<span class="token operator">!</span>
</span></code></pre></div></div></div><div id="comment"></div><footer><div class="flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base"><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog/set-up-k8s-cluster-kubespray-on-virtualbox-ubuntu2204">← <!-- -->Setting up a Kubernetes Cluster using Kubespray on VirtualBox with Ubuntu 22.04</a></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog/k8s_loadbalanacer-ingress_relation_chatgpt_answer">K8S manifest - LoadBalancer Ingress Relation chatgpt conversation<!-- --> →</a></div></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:demian11k@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/demian9k"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>demian11k</div><div> • </div><div>© 2023</div><div> • </div><a href="/">demian11k studylog</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var o=Object.create;var c=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var i=a=\u003ec(a,\"__esModule\",{value:!0});var u=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{i(a);for(var l in s)c(a,l,{get:s[l],enumerable:!0})},k=(a,s,l)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!h.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026c(a,n,{get:()=\u003es[n],enumerable:!(l=d(s,n))||l.enumerable});return a},g=a=\u003ek(i(c(a!=null?o(m(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var t=u((I,r)=\u003e{r.exports=_jsx_runtime});var x={};N(x,{default:()=\u003eE,frontmatter:()=\u003eb});var e=g(t()),b={title:\"Hands-On Example: Ingress and Bare Metal Load Balancer in Kubernetes\",date:new Date(16859232e5),lastmod:\"2023-06-05\",tags:[\"Kubernetes\",\"Ingress\",\"LoadBalancer\"],draft:!1,summary:\"\",layout:\"PostSimple\",canonicalUrl:\"https://demian9k.github.io/blog/ingress-ctrl-baremetal-lb-in-k8s/\"};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(l,{})})):l();function l(){let n=Object.assign({p:\"p\",br:\"br\",ul:\"ul\",li:\"li\",h3:\"h3\",a:\"a\",span:\"span\",pre:\"pre\",code:\"code\",h4:\"h4\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"\\uC774 \\uBB38\\uC11C\\uB294 Production level\\uC758 \\uCFE0\\uBC84\\uB124\\uD2F0\\uC2A4 \\uD074\\uB7EC\\uC2A4\\uD130\\uC5D0\\uC11C \\uC0AC\\uC6A9\\uB418\\uB294 Resource\\uC778 Ingress \\uC640 LoadBalancer(Service)\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC \\uD074\\uB7EC\\uC2A4\\uD130 \\uC678\\uBD80\\uC5D0\\uC11C \\uC2E4\\uC81C containerized app\\uC73C\\uB85C \\uC804\\uB2EC\\uB418\\uAE30 \\uAE4C\\uC9C0\\uC758 \\uACFC\\uC815\\uC758 configuration\\uC744 \\uC11C\\uC220\\uD55C\\uB2E4.\"}),(0,e.jsxs)(n.p,{children:[\"\\uBAA8\\uB4E0 \\uC124\\uC815\\uC774 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC644\\uB8CC\\uB418\\uBA74 \\uC694\\uCCAD\\uC758 \\uD750\\uB984\\uC740 \\uC544\\uB798 \\uC21C\\uC11C\\uB300\\uB85C \\uC6C0\\uC9C1\\uC778\\uB2E4.\",(0,e.jsx)(n.br,{}),\"LoadBalancer -\u003e Ingress-Controller -\u003e NodePort Service -\u003e Deployment -\u003e Pod -\u003e Container\"]}),(0,e.jsx)(n.p,{children:\"\\uD14C\\uC2A4\\uD2B8 \\uD658\\uACBD\\uC740 VirtualBox\\uB85C \\uAD6C\\uC131\\uB41C Linux VM 3\\uAC1C \\uB178\\uB4DC\\uC774\\uBA70 \\uC544\\uB798\\uCC98\\uB7FC \\uAD6C\\uC131\\uB41C\\uB2E4.\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"Node1 : 192.168.100.1(Control-plane)\"}),(0,e.jsx)(n.li,{children:\"Node2 : 192.168.100.2(Control-plane)\"}),(0,e.jsx)(n.li,{children:\"Node3 : 192.168.100.3\"})]}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \\uD14C\\uC2A4\\uD2B8\\uB97C \\uC704\\uD55C \\uC678\\uBD80 \\uD638\\uC2A4\\uD2B8\\uB294 192.168.100.100 IP\\uB97C \\uAC16\\uACE0 \\uD574\\uB2F9 \\uB178\\uB4DC\\uC640 \\uD1B5\\uC2E0\\uC774 \\uAC00\\uB2A5\\uD55C host computer(windows 10) \\uC774\\uB2E4.\",(0,e.jsx)(n.br,{}),\"guest OS\\uC640 host\\uB294 VirtualBox\\uC758 192.168.100.0/24 network \\uBC94\\uC704 \\uC548\\uC5D0 \\uC788\\uB294 \\uC7A5\\uCE58\\uB4E4\\uC774\\uB2E4.\"]}),(0,e.jsxs)(n.h3,{id:\"1-apply-deployment-for-app\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#1-apply-deployment-for-app\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"1. Apply Deployment for App\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" hello\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`world\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"run\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" load\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"balancer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`example\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"replicas\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"template\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"run\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" load\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"balancer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`example\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" hello\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`world\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" gcr.io/google\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"samples/node\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"hello\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1.0\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:'#\\uC774\\uBBF8\\uC9C0\\uB294 /\\uB85C \\uC694\\uCCAD\\uD588\\uC744 \\uB54C \"Hello Kubernetes\" \\uBB38\\uC790\\uC5F4\\uC744 \\uC751\\uB2F5\\uD558\\uB294 \\uC11C\\uBC84\\uC774\\uB2E4.'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containerPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"protocol\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` TCP\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"2-expose-nodeport-service\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#2-expose-nodeport-service\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"2. Expose NodePort Service\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# kubectl expose deployment hello-world --type=NodePort --name=example-service\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Service\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" example\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`service\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"nodePort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"31349\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"port\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"protocol\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` TCP\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"targetPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"run\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" load\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"balancer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`example\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` NodePort\n`]})]})}),(0,e.jsxs)(n.h4,{id:\"testing-nodeport\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#testing-nodeport\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"testing NodePort\"]}),(0,e.jsx)(n.p,{children:\"\\uD074\\uB7EC\\uC2A4\\uD130 \\uC678\\uBD80\\uC5D0\\uC11C \u003cnode1 ip\u003e:\u003cnodePort\u003e \\uB85C \\uD14C\\uC2A4\\uD2B8\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"192.168\"}),`.100.1:31349\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Hello Kubernetes\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"apply-ingress-controller-loadbalancer\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#apply-ingress-controller-loadbalancer\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Apply Ingress-Controller, LoadBalancer\"]}),(0,e.jsx)(n.p,{children:\"nginx-ingress-controller, metalLB \\uC124\\uCE58\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"#ingress-nginx\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.8.0/deploy/static/provider/cloud/deploy.yaml\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"#metalLB\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.13.10/config/manifests/metallb-native.yaml\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"#check metalLB resources\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"demian@node1:~/metallb$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` kubectl get all -n metallb-system\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`NAME                              READY   STATUS    RESTARTS      AGE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"pod/controller-5fd797fbf7-plr77   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"/1     Running   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`             158m\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"pod/speaker-6wvmj                 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"/1     Running   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`             139m\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"pod/speaker-bq5tv                 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"/1     Running   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"13m ago\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`   158m\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"pod/speaker-s5nxl                 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"/1     Running   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`             158m\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"NAME                      TYPE        CLUSTER-IP    EXTERNAL-IP   PORT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"S\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`   AGE\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"service/webhook-service   ClusterIP   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.233\"}),\".7.27   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"none\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\"        \",(0,e.jsx)(n.span,{className:\"token number\",children:\"443\"}),`/TCP   158m\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`NAME                     DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"daemonset.apps/speaker   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\"         \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\"         \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\"       \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\"            \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\"           kubernetes.io/os\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`linux   158m\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`NAME                         READY   UP-TO-DATE   AVAILABLE   AGE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"deployment.apps/controller   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"/1     \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"            \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`           158m\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`NAME                                    DESIRED   CURRENT   READY   AGE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"replicaset.apps/controller-5fd797fbf7   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"         \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"         \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`       158m\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"apply-l2-metallb-customresources\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#apply-l2-metallb-customresources\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Apply L2 MetalLB CustomResources\"]}),(0,e.jsx)(n.p,{children:\"metalLB\\uC5D0\\uC11C \\uC9C0\\uC6D0\\uD558\\uB294 2\\uAC00\\uC9C0\\uC758 external network \\uC5F0\\uACB0 \\uBC29\\uBC95(L2(ARP), L3(BGP)) \\uC911 Layer2\\uC5D0\\uC11C advertise \\uD558\\uB294 \\uBC29\\uBC95\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC LoadBalancer\\uC5D0\\uC11C ingress-controller\\uC5D0 \\uD560\\uB2F9\\uD560 external ip address pool \\uBC0F L2Advertisement \\uB9AC\\uC18C\\uC2A4\\uB97C \\uC0DD\\uC131\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` metallb.io/v1beta1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` IPAddressPool\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" first\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`pool\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" metallb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`system\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"addresses\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" 192.168.100.10\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`192.168.100.99\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"---\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` metallb.io/v1beta1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` L2Advertisement\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"network\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`l2\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" metallb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`system\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ipAddressPools\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" first\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`pool\n`]})]})}),(0,e.jsxs)(n.h4,{id:\"metallb-\\uB9AC\\uC18C\\uC2A4-\\uC801\\uC6A9-\\uD655\\uC778\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#metallb-\\uB9AC\\uC18C\\uC2A4-\\uC801\\uC6A9-\\uD655\\uC778\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"metalLB \\uB9AC\\uC18C\\uC2A4 \\uC801\\uC6A9 \\uD655\\uC778\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"demian@node1:~/metallb$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` kubectl get IPAddressPool,L2Advertisement -n metallb-system\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`NAME                                  AUTO ASSIGN   AVOID BUGGY IPS   ADDRESSES\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ipaddresspool.metallb.io/first-pool   \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),\"          \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),\"             \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"192.168.100.10-192.168.100.99\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`NAME                                       IPADDRESSPOOLS   IPADDRESSPOOL SELECTORS   INTERFACES\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"l2advertisement.metallb.io/my-network-l2   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"first-pool\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,e.jsxs)(n.h4,{id:\"lb\\uC5D0-\\uC758\\uD574-ingress-controller\\uC758-external-ip\\uC5D0-\\uD560\\uB2F9-\\uD655\\uC778\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#lb\\uC5D0-\\uC758\\uD574-ingress-controller\\uC758-external-ip\\uC5D0-\\uD560\\uB2F9-\\uD655\\uC778\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"LB\\uC5D0 \\uC758\\uD574 ingress-controller\\uC758 EXTERNAL-IP\\uC5D0 \\uD560\\uB2F9 \\uD655\\uC778\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"demian@node1:~/metallb$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` kubectl get all -n ingress-nginx\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`NAME                                            READY   STATUS      RESTARTS   AGE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"pod/ingress-nginx-admission-create-sg4zf        \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\"/1     Completed   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`          170m\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"pod/ingress-nginx-admission-patch-246vx         \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\"/1     Completed   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`          170m\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"pod/ingress-nginx-controller-7d98bbddbd-hwm2n   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"/1     Running     \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`          170m\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"NAME                                         TYPE           CLUSTER-IP     EXTERNAL-IP      PORT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"S\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`                      AGE\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"service/ingress-nginx-controller             LoadBalancer   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.233\"}),\".2.130   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"192.168\"}),\".100.10   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),`:32347/TCP,443:32404/TCP   170m\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"service/ingress-nginx-controller-admission   ClusterIP      \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.233\"}),\".49.33   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"none\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\"           \",(0,e.jsx)(n.span,{className:\"token number\",children:\"443\"}),`/TCP                      170m\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"deployment.apps/ingress-nginx-controller   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"/1     \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"            \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`           170m\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`NAME                                                  DESIRED   CURRENT   READY   AGE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"replicaset.apps/ingress-nginx-controller-7d98bbddbd   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"         \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"         \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`       170m\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`NAME                                       COMPLETIONS   DURATION   AGE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"job.batch/ingress-nginx-admission-create   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`/1           4s         170m\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"job.batch/ingress-nginx-admission-patch    \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`/1           5s         170m\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"ingress-\\uB9AC\\uC18C\\uC2A4-\\uC801\\uC6A9\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#ingress-\\uB9AC\\uC18C\\uC2A4-\\uC801\\uC6A9\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Ingress \\uB9AC\\uC18C\\uC2A4 \\uC801\\uC6A9\"]}),(0,e.jsxs)(n.p,{children:[\"\\uC544\\uB798 Ingress\\uB294 ingressClassName\\uC758 \\uAC12\\uC73C\\uB85C \",(0,e.jsx)(n.code,{children:\"nginx\"}),\" \\uB97C \\uC124\\uC815\\uD55C\\uB2E4. \\uC774\\uC804 \\uB2E8\\uACC4\\uC5D0\\uC11C \\uAD6C\\uC131\\uD55C nginx-ingress-controller manifest \\uC911 IngressClass\\uC758 metadata.name\\uACFC \\uB3D9\\uC77C\\uD558\\uAC8C \\uD558\\uC5EC Ingress\\uAC00 ingress-controller\\uB85C nginx\\uB97C \\uC0AC\\uC6A9\\uD560 \\uAC83\\uC784\\uC744 \\uBA85\\uC2DC\\uD55C\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:\"Ingress \\uB9AC\\uC18C\\uC2A4\\uB294 Ingress-Controller\\uAC00 \\uC0AC\\uC6A9\\uD558\\uB294 \\uC815\\uCC45\\uC744 \\uC815\\uC758\\uD55C\\uB2E4. \\uC544\\uB798\\uB294 rules\\uC5D0\\uC11C /hello\\uB85C \\uB4E4\\uC5B4\\uC624\\uB294 \\uC694\\uCCAD\\uC744 example-service\\uC758 8080 \\uD3EC\\uD2B8\\uB85C \\uB77C\\uC6B0\\uD305\\uD558\\uB3C4\\uB85D \\uBA85\\uC2DC\\uD558\\uC600\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` networking.k8s.io/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Ingress\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" hello\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`ingress\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"annotations\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"nginx.ingress.kubernetes.io/rewrite-target\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ingressClassName\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"rules\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"http\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"paths\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"path\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /hello\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"pathType\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Prefix\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"backend\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"service\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" example\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`service\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"port\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"number\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uC544\\uB798\\uB294 ingress-nginx-controller manifest \\uC911 \\uD558\\uB098\\uC778 IngressClass \\uC774\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` networking.k8s.io/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` IngressClass\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/component\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` controller\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/instance\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/part-of\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/version\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` 1.8.0\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"controller\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" k8s.io/ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]})]})}),(0,e.jsxs)(n.h4,{id:\"\\uD074\\uB7EC\\uC2A4\\uD130-\\uC678\\uBD80\\uC5D0\\uC11C-ingress-external-ip\\uB85C-\\uD14C\\uC2A4\\uD2B8\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#\\uD074\\uB7EC\\uC2A4\\uD130-\\uC678\\uBD80\\uC5D0\\uC11C-ingress-external-ip\\uB85C-\\uD14C\\uC2A4\\uD2B8\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uD074\\uB7EC\\uC2A4\\uD130 \\uC678\\uBD80\\uC5D0\\uC11C ingress external ip\\uB85C \\uD14C\\uC2A4\\uD2B8\"]}),(0,e.jsxs)(n.p,{children:[\"Ingress\\uAE4C\\uC9C0 \\uAD6C\\uC131\\uD558\\uBA74 \\uC544\\uB798 \\uC21C\\uC11C\\uB300\\uB85C \\uC694\\uCCAD\\uC774 \\uD750\\uB974\\uB3C4\\uB85D \\uAD6C\\uC131\\uB41C \\uAC83\\uC774\\uB2E4.\",(0,e.jsx)(n.br,{}),\"LoadBalancer -\u003e Ingress-Controller -\u003e NodePort Service -\u003e Deployment -\u003e Pod -\u003e Container\",(0,e.jsx)(n.br,{}),\"\\uC774\\uC81C \\uD074\\uB7EC\\uC2A4\\uD130 \\uC678\\uBD80\\uC5D0\\uC11C LB\\uB97C \\uD1B5\\uD574 192.168.100.10\\uC5D0 \\uC811\\uADFC \\uAC00\\uB2A5\\uD574\\uC84C\\uC73C\\uBBC0\\uB85C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uD14C\\uC2A4\\uD2B8\\uD558\\uBA74 \\uC131\\uACF5\\uD55C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"192.168\"}),`.100.10/hello\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Hello Kubernetes\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]})]})})]})}}var E=y;return x;})();\n;return Component;","toc":[{"value":"1. Apply Deployment for App","url":"#1-apply-deployment-for-app","depth":3},{"value":"2. Expose NodePort Service","url":"#2-expose-nodeport-service","depth":3},{"value":"testing NodePort","url":"#testing-nodeport","depth":4},{"value":"Apply Ingress-Controller, LoadBalancer","url":"#apply-ingress-controller-loadbalancer","depth":3},{"value":"Apply L2 MetalLB CustomResources","url":"#apply-l2-metallb-customresources","depth":3},{"value":"metalLB 리소스 적용 확인","url":"#metallb-리소스-적용-확인","depth":4},{"value":"LB에 의해 ingress-controller의 EXTERNAL-IP에 할당 확인","url":"#lb에-의해-ingress-controller의-external-ip에-할당-확인","depth":4},{"value":"Ingress 리소스 적용","url":"#ingress-리소스-적용","depth":3},{"value":"클러스터 외부에서 ingress external ip로 테스트","url":"#클러스터-외부에서-ingress-external-ip로-테스트","depth":4}],"frontMatter":{"readingTime":{"text":"6 min read","minutes":5.195,"time":311700,"words":1039},"slug":"ingress-ctrl-baremetal-lb-in-k8s","fileName":"ingress-ctrl-baremetal-lb-in-k8s.mdx","title":"Hands-On Example: Ingress and Bare Metal Load Balancer in Kubernetes","date":"2023-06-05T00:00:00.000Z","lastmod":"2023-06-05","tags":["Kubernetes","Ingress","LoadBalancer"],"draft":false,"summary":"","layout":"PostSimple","canonicalUrl":"https://demian9k.github.io/blog/ingress-ctrl-baremetal-lb-in-k8s/"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.155,"time":9300,"words":31},"slug":["default"],"fileName":"default.md","name":"demian11k","avatar":"/static/images/avatar.png","email":"demian11k@gmail.com","github":"https://github.com/demian9k","date":null}],"prev":{"title":"Setting up a Kubernetes Cluster using Kubespray on VirtualBox with Ubuntu 22.04","date":"2023-06-04T02:02:11.000Z","lastmod":"2023-06-04","tags":["kubernetes","ubuntu","virtualbox"],"draft":false,"summary":"","layout":"PostSimple","canonicalUrl":"https://demian9k.github.io/blog/set-up-k8s-cluster-kubespray-on-virtualbox-ubuntu2204/","slug":"set-up-k8s-cluster-kubespray-on-virtualbox-ubuntu2204"},"next":{"title":"K8S manifest - LoadBalancer Ingress Relation chatgpt conversation","date":"2023-06-05T03:03:00.000Z","lastmod":"2023-06-05","tags":["kubernetes"],"draft":false,"summary":"","layout":"PostSimple","slug":"k8s_loadbalanacer-ingress_relation_chatgpt_answer"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["ingress-ctrl-baremetal-lb-in-k8s"]},"buildId":"R1cpZtUWE2mFLIblfb-kJ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>